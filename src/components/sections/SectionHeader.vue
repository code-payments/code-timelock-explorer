<script lang="ts">
import { computed, defineComponent, ref } from "vue";
import DialogClusterSettings from "../dialogs/DialogClusterSettings.vue";
import Button from "../elements/Button.vue";
import { getProvider } from "@/types";

const isScrolled = ref(false);
const isConnected = ref(true);
const intervalRef = ref(0);
const showClusterSettings = ref(false);

const classNames = computed(() => {
    return 'sticky top-0 z-50 px-4 py-5 shadow-md shadow-slate-900/5 transition duration-500 dark:shadow-none sm:px-6 lg:px-8 dark:bg-transparent' +
        (isScrolled.value ? 'dark:bg-slate-900/95 dark:backdrop-blur dark:[@supports(backdrop-filter:blur(0))]:bg-slate-900/75' : 'dark:bg-transparent');
})

export default defineComponent({
    components: {
        DialogClusterSettings,
        Button
    },

    setup() {
        return {
            classNames,
            isConnected,
            isScrolled,
            showClusterSettings,
        }
    },

    methods: {
        onScroll() {
            isScrolled.value = window.scrollY > 0;
        },

        async onInterval() {
            const { connection } = getProvider();

            try {
                const slot = await connection().getSlot();
                if (slot > 0) {
                    isConnected.value = true;
                }
            } catch (e) {
                isConnected.value = false;
            }
        },

        openClusterSettings() {
            showClusterSettings.value = true;
        }
    },

    mounted() {
        window.addEventListener('scroll', this.onScroll, { passive: true });
        intervalRef.value = setInterval(this.onInterval, 1000) as unknown as number;
    },

    beforeUnmount() {
        window.removeEventListener('scroll', this.onScroll);
        clearInterval(intervalRef.value);
    }
});
</script>

<template>

    <DialogClusterSettings v-model="showClusterSettings" />

    <header :class="classNames">
        <div class="mx-auto max-w-7xl flex flex-wrap items-center justify-between">
            <div class="relative hidden md:flex flex-grow basis-0 items-center">
                <a href="/code-timelock-explorer/" class="text-white pl-2">

                    <svg width="277" height="191" viewBox="0 0 277 191" class="h-11 w-11 inline-block align-top">
                        <g fill="#38BDF8">

                            <mask id="path-1-inside-1_3_300" fill="white">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M232.518 95.1398C232.518 147.537 196.279 190.013 151.577 190.013C151.41 190.013 151.242 190.012 151.075 190.011C150.083 190.018 149.079 190.004 148.064 189.969C125.785 189.202 108.373 179.928 92.8839 167.427C104.156 173.486 116.731 177.512 131.548 177.976C132.523 178.007 133.487 178.019 134.441 178.013L134.603 178.013C134.709 178.014 134.815 178.014 134.921 178.014C177.855 178.014 212.66 140.91 212.66 95.1398C212.66 49.3696 177.855 12.2655 134.921 12.2655C134.762 12.2655 134.602 12.2661 134.443 12.2671C133.489 12.261 132.523 12.273 131.548 12.3035C116.731 12.7673 104.156 16.794 92.8838 22.8523C108.373 10.3515 125.785 1.07707 148.064 0.310387C149.08 0.27545 150.084 0.261715 151.077 0.268621C151.243 0.267438 151.41 0.266846 151.577 0.266846C196.279 0.266846 232.518 42.7429 232.518 95.1398Z" />
                            </mask>
                            <path
                                d="M151.075 190.011L151.217 170.011L151.077 170.01L150.936 170.011L151.075 190.011ZM148.064 189.969L147.377 209.957L147.377 209.957L148.064 189.969ZM92.8839 167.427L102.352 149.81L80.323 182.991L92.8839 167.427ZM131.548 177.976L132.173 157.986L132.173 157.986L131.548 177.976ZM134.441 178.013L134.549 158.013L134.432 158.012L134.315 158.013L134.441 178.013ZM134.603 178.013L134.495 198.013L134.507 198.013L134.52 198.013L134.603 178.013ZM134.443 12.2671L134.316 32.2667L134.444 32.2675L134.572 32.2667L134.443 12.2671ZM131.548 12.3035L130.922 -7.68667L130.922 -7.68667L131.548 12.3035ZM92.8838 22.8523L80.3229 7.28877L102.352 40.4692L92.8838 22.8523ZM148.064 0.310387L147.377 -19.6778L147.377 -19.6778L148.064 0.310387ZM151.077 0.268621L150.938 20.2681L151.078 20.2691L151.219 20.2681L151.077 0.268621ZM151.577 210.013C210.186 210.013 252.518 155.485 252.518 95.1398H212.518C212.518 139.588 182.372 170.013 151.577 170.013V210.013ZM150.933 210.01C151.148 210.012 151.362 210.013 151.577 210.013V170.013C151.457 170.013 151.337 170.012 151.217 170.011L150.933 210.01ZM147.377 209.957C148.664 210.002 149.943 210.019 151.214 210.01L150.936 170.011C150.222 170.016 149.494 170.007 148.752 169.981L147.377 209.957ZM80.323 182.991C97.8495 197.136 119.316 208.992 147.377 209.957L148.752 169.981C132.255 169.413 118.896 162.72 105.445 151.864L80.323 182.991ZM83.416 185.044C97.0412 192.367 112.619 197.393 130.922 197.966L132.173 157.986C120.844 157.631 111.272 154.604 102.352 149.81L83.416 185.044ZM130.922 197.966C132.146 198.005 133.361 198.02 134.568 198.012L134.315 158.013C133.614 158.017 132.9 158.009 132.173 157.986L130.922 197.966ZM134.334 198.012L134.495 198.013L134.711 158.014L134.549 158.013L134.334 198.012ZM134.52 198.013C134.653 198.014 134.786 198.014 134.921 198.014V158.014C134.844 158.014 134.766 158.014 134.686 158.014L134.52 198.013ZM134.921 198.014C190.087 198.014 232.66 150.731 232.66 95.1398H192.66C192.66 131.089 165.623 158.014 134.921 158.014V198.014ZM232.66 95.1398C232.66 39.5484 190.087 -7.73446 134.921 -7.73446V32.2655C165.623 32.2655 192.66 59.1908 192.66 95.1398H232.66ZM134.921 -7.73446C134.719 -7.73446 134.517 -7.73381 134.315 -7.73251L134.572 32.2667C134.688 32.2659 134.805 32.2655 134.921 32.2655V-7.73446ZM134.57 -7.73252C133.363 -7.7402 132.146 -7.72499 130.922 -7.68667L132.173 32.2938C132.901 32.271 133.615 32.2622 134.316 32.2667L134.57 -7.73252ZM130.922 -7.68667C112.619 -7.11381 97.0411 -2.08741 83.4158 5.23534L102.352 40.4692C111.272 35.6754 120.844 32.6483 132.173 32.2938L130.922 -7.68667ZM147.377 -19.6778C119.316 -18.7121 97.8493 -6.85641 80.3229 7.28877L105.445 38.4158C118.896 27.5593 132.255 20.8663 148.752 20.2986L147.377 -19.6778ZM151.216 -19.7309C149.945 -19.7397 148.665 -19.7221 147.377 -19.6778L148.752 20.2986C149.494 20.273 150.223 20.2632 150.938 20.2681L151.216 -19.7309ZM151.577 -19.7332C151.363 -19.7332 151.149 -19.7324 150.935 -19.7309L151.219 20.2681C151.338 20.2673 151.458 20.2668 151.577 20.2668V-19.7332ZM252.518 95.1398C252.518 34.7942 210.186 -19.7332 151.577 -19.7332V20.2668C182.372 20.2668 212.518 50.6916 212.518 95.1398H252.518Z"
                                mask="url(#path-1-inside-1_3_300)" />
                            <mask id="path-3-inside-2_3_300" fill="white">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M122.919 29.6514C122.121 29.6466 121.313 29.656 120.497 29.6802C91.4272 30.5409 72.6851 46.9334 54.112 63.1781C39.6354 75.8398 25.2616 88.4117 6.1803 93.4687V93.4713L0 95.1392L6.1803 96.8071V96.8113C25.2616 101.868 39.6354 114.44 54.112 127.102C72.685 143.347 91.4272 159.739 120.497 160.6C121.315 160.624 122.125 160.633 122.926 160.628C123.055 160.629 123.185 160.63 123.315 160.63C159.18 160.63 188.255 131.309 188.255 95.1399C188.255 58.971 159.18 29.6502 123.315 29.6502C123.183 29.6502 123.051 29.6506 122.919 29.6514Z" />
                            </mask>
                            <path
                                d="M120.497 29.6802L121.089 49.6714L121.089 49.6714L120.497 29.6802ZM122.919 29.6514L122.798 49.651L122.919 49.6518L123.039 49.6511L122.919 29.6514ZM54.112 63.1781L40.9451 48.1238L40.945 48.1238L54.112 63.1781ZM6.1803 93.4687L1.05666 74.1361L-13.8197 78.0788L-13.8197 93.4687H6.1803ZM6.1803 93.4713L11.3913 112.781L26.1803 108.789V93.4713H6.1803ZM0 95.1392L-5.21096 75.83L-76.7613 95.1392L-5.21095 114.448L0 95.1392ZM6.1803 96.8071H26.1803V81.489L11.3913 77.4979L6.1803 96.8071ZM6.1803 96.8113H-13.8197V112.201L1.05665 116.144L6.1803 96.8113ZM54.112 127.102L67.279 112.048L67.279 112.048L54.112 127.102ZM120.497 160.6L121.089 140.608L121.088 140.608L120.497 160.6ZM122.926 160.628L123.043 140.629L122.923 140.628L122.802 140.629L122.926 160.628ZM121.089 49.6714C121.669 49.6542 122.239 49.6477 122.798 49.651L123.04 9.65178C122.002 9.64548 120.957 9.65782 119.905 9.68897L121.089 49.6714ZM67.279 78.2323C86.395 61.5128 100.098 50.2929 121.089 49.6714L119.905 9.68897C82.7563 10.7888 58.9752 32.354 40.9451 48.1238L67.279 78.2323ZM11.3039 112.801C35.633 106.353 53.3952 90.3756 67.279 78.2323L40.945 48.1238C25.8757 61.304 14.8902 70.4699 1.05666 74.1361L11.3039 112.801ZM26.1803 93.4713V93.4687H-13.8197V93.4713H26.1803ZM5.21096 114.448L11.3913 112.781L0.969337 74.1621L-5.21096 75.83L5.21096 114.448ZM11.3913 77.4979L5.21095 75.83L-5.21095 114.448L0.969348 116.116L11.3913 77.4979ZM26.1803 96.8113V96.8071H-13.8197V96.8113H26.1803ZM67.279 112.048C53.3951 99.9043 35.633 83.9265 11.304 77.4787L1.05665 116.144C14.8902 119.81 25.8757 128.976 40.945 142.156L67.279 112.048ZM121.088 140.608C100.098 139.987 86.3949 128.767 67.279 112.048L40.945 142.156C58.9751 157.926 82.7563 179.491 119.905 180.591L121.088 140.608ZM122.802 140.629C122.242 140.632 121.671 140.626 121.089 140.608L119.905 180.591C120.959 180.622 122.008 180.635 123.049 180.628L122.802 140.629ZM123.315 140.63C123.224 140.63 123.134 140.629 123.043 140.629L122.808 180.628C122.977 180.629 123.146 180.63 123.315 180.63V140.63ZM168.255 95.1399C168.255 120.423 147.976 140.63 123.315 140.63V180.63C170.385 180.63 208.255 142.195 208.255 95.1399H168.255ZM123.315 49.6502C147.976 49.6502 168.255 69.8573 168.255 95.1399H208.255C208.255 48.0846 170.385 9.65022 123.315 9.65022V49.6502ZM123.039 49.6511C123.131 49.6505 123.223 49.6502 123.315 49.6502V9.65022C123.143 9.65022 122.971 9.65074 122.799 9.65177L123.039 49.6511Z"
                                mask="url(#path-3-inside-2_3_300)" />
                            <mask id="path-5-inside-3_3_300" fill="white">
                                <path fill-rule="evenodd" clip-rule="evenodd"
                                    d="M213.077 9.43513C213.049 9.40397 213.022 9.37282 212.995 9.3417C250.526 23.372 276.898 56.5033 276.898 95.14C276.898 133.777 250.526 166.908 212.994 180.938C213.027 180.901 213.059 180.865 213.091 180.828C239.656 161.807 256.991 130.516 256.991 95.1367C256.991 59.7513 239.649 28.4547 213.077 9.43513Z" />
                            </mask>
                            <path
                                d="M213.077 9.43513L198.038 22.6205L199.56 24.3555L201.436 25.6984L213.077 9.43513ZM212.995 9.3417L219.998 -9.39211L197.97 22.5423L212.995 9.3417ZM212.994 180.938L197.969 167.739L219.997 199.672L212.994 180.938ZM213.091 180.828L201.448 164.566L199.573 165.909L198.052 167.643L213.091 180.828ZM228.115 -3.75029C228.083 -3.78651 228.051 -3.82271 228.019 -3.85889L197.97 22.5423C197.993 22.5684 198.016 22.5944 198.038 22.6205L228.115 -3.75029ZM205.991 28.0755C237.046 39.6845 256.898 66.1919 256.898 95.14H296.898C296.898 46.8148 264.007 7.05951 219.998 -9.39211L205.991 28.0755ZM256.898 95.14C256.898 124.088 237.046 150.596 205.991 162.205L219.997 199.672C264.006 183.221 296.898 143.465 296.898 95.14H256.898ZM228.02 194.138C228.057 194.096 228.094 194.054 228.131 194.012L198.052 167.643C198.025 167.675 197.997 167.707 197.969 167.739L228.02 194.138ZM224.735 197.089C256.359 174.445 276.991 137.191 276.991 95.1367H236.991C236.991 123.84 222.952 149.169 201.448 164.566L224.735 197.089ZM276.991 95.1367C276.991 53.0748 256.351 15.8142 224.717 -6.82819L201.436 25.6984C222.947 41.0952 236.991 66.4278 236.991 95.1367H276.991Z"
                                mask="url(#path-5-inside-3_3_300)" />
                        </g>

                    </svg>

                    <span class="ml-2 pt-[2px] text-2xl font-bold tracking-tight md:inline-block hidden">Timelock
                        Explorer</span>
                </a>
            </div>

            <div v-if="!isConnected" class="-my-5 mr-0">
                <button @click="openClusterSettings" type="button"
                    class="group h-6 w-6 whitespace-nowrap  h-auto w-fit flex-none rounded-lg py-2.5 pl-4 pr-3.5 text-sm ring-1 ring-slate-200 hover:ring-slate-300 dark:bg-slate-800/75 dark:ring-inset dark:ring-white/5 dark:hover:bg-slate-700/40 dark:hover:ring-slate-500 ">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" stroke="#e37b7b"
                        class="h-5 w-5 inline-block" style="fill: none;">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z">
                        </path>

                    </svg>
                    <span class="whitespace-nowrap text-xs md:text-sm ml-2 md:text-slate-500 md:dark:text-slate-400" style="color: #e37b7b;">Not connected to network</span>
                </button>
            </div>

            <div class="relative flex basis-0 justify-end gap-6 gap-8 flex-grow">
                <Button @click="openClusterSettings" variant="primary">Settings</Button>

                <a class="group" aria-label="GitHub" href="https://github.com/code-payments/code-timelock-explorer">
                    <svg aria-hidden="true" viewBox="0 0 16 16"
                        class="h-9 w-9 fill-slate-400 group-hover:fill-slate-500 dark:group-hover:fill-slate-300">
                        <path
                            d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z">
                        </path>
                    </svg>
                </a>
            </div>
        </div>
    </header>

</template>