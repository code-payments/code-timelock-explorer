import{s as j,E as q,P as R}from"./index-dc138269.js";var M=j.Buffer;function z(s){if(s.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),n=0;n<e.length;n++)e[n]=255;for(var t=0;t<s.length;t++){var a=s.charAt(t),i=a.charCodeAt(0);if(e[i]!==255)throw new TypeError(a+" is ambiguous");e[i]=t}var r=s.length,u=s.charAt(0),m=Math.log(r)/Math.log(256),_=Math.log(256)/Math.log(r);function g(o){if((Array.isArray(o)||o instanceof Uint8Array)&&(o=M.from(o)),!M.isBuffer(o))throw new TypeError("Expected Buffer");if(o.length===0)return"";for(var d=0,b=0,h=0,p=o.length;h!==p&&o[h]===0;)h++,d++;for(var f=(p-h)*_+1>>>0,l=new Uint8Array(f);h!==p;){for(var v=o[h],y=0,c=f-1;(v!==0||y<b)&&c!==-1;c--,y++)v+=256*l[c]>>>0,l[c]=v%r>>>0,v=v/r>>>0;if(v!==0)throw new Error("Non-zero carry");b=y,h++}for(var w=f-b;w!==f&&l[w]===0;)w++;for(var K=u.repeat(d);w<f;++w)K+=s.charAt(l[w]);return K}function E(o){if(typeof o!="string")throw new TypeError("Expected String");if(o.length===0)return M.alloc(0);for(var d=0,b=0,h=0;o[d]===u;)b++,d++;for(var p=(o.length-d)*m+1>>>0,f=new Uint8Array(p);o[d];){var l=e[o.charCodeAt(d)];if(l===255)return;for(var v=0,y=p-1;(l!==0||v<h)&&y!==-1;y--,v++)l+=r*f[y]>>>0,f[y]=l%256>>>0,l=l/256>>>0;if(l!==0)throw new Error("Non-zero carry");h=v,d++}for(var c=p-h;c!==p&&f[c]===0;)c++;var w=M.allocUnsafe(b+(p-c));w.fill(0,0,b);for(var K=b;c!==p;)w[K++]=f[c++];return w}function P(o){var d=E(o);if(d)return d;throw new Error("Non-base"+r+" character")}return{encode:g,decodeUnsafe:E,decode:P}}var x=z,S=x,T="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",D=S(T);const U=D;var A=globalThis&&globalThis.__awaiter||function(s,e,n,t){function a(i){return i instanceof n?i:new n(function(r){r(i)})}return new(n||(n=Promise))(function(i,r){function u(g){try{_(t.next(g))}catch(E){r(E)}}function m(g){try{_(t.throw(g))}catch(E){r(E)}}function _(g){g.done?i(g.value):a(g.value).then(u,m)}_((t=t.apply(s,e||[])).next())})};class B extends q{constructor(e,n){if(super(),this._network=n,this._publicKey=null,this._popup=null,this._handlerAdded=!1,this._nextRequestId=1,this._autoApprove=!1,this._responsePromises=new Map,this.handleMessage=t=>{var a;if(this._injectedProvider&&t.source===window||t.origin===((a=this._providerUrl)===null||a===void 0?void 0:a.origin)&&t.source===this._popup){if(t.data.method==="connected"){const i=new R(t.data.params.publicKey);(!this._publicKey||!this._publicKey.equals(i))&&(this._publicKey&&!this._publicKey.equals(i)&&this.handleDisconnect(),this._publicKey=i,this._autoApprove=!!t.data.params.autoApprove,this.emit("connect",this._publicKey))}else if(t.data.method==="disconnected")this.handleDisconnect();else if(t.data.result||t.data.error){const i=this._responsePromises.get(t.data.id);if(i){const[r,u]=i;t.data.result?r(t.data.result):u(new Error(t.data.error))}}}},this._beforeUnload=()=>{this.disconnect()},C(e))this._injectedProvider=e;else if(k(e))this._providerUrl=new URL(e),this._providerUrl.hash=new URLSearchParams({origin:window.location.origin,network:this._network}).toString();else throw new Error("provider parameter must be an injected provider or a URL string.")}handleConnect(){var e;return this._handlerAdded||(this._handlerAdded=!0,window.addEventListener("message",this.handleMessage),window.addEventListener("beforeunload",this._beforeUnload)),this._injectedProvider?new Promise(n=>{this.sendRequest("connect",{}),n()}):(window.name="parent",this._popup=window.open((e=this._providerUrl)===null||e===void 0?void 0:e.toString(),"_blank","location,resizable,width=460,height=675"),new Promise(n=>{this.once("connect",n)}))}handleDisconnect(){this._handlerAdded&&(this._handlerAdded=!1,window.removeEventListener("message",this.handleMessage),window.removeEventListener("beforeunload",this._beforeUnload)),this._publicKey&&(this._publicKey=null,this.emit("disconnect")),this._responsePromises.forEach(([,e],n)=>{this._responsePromises.delete(n),e(new Error("Wallet disconnected"))})}sendRequest(e,n){return A(this,void 0,void 0,function*(){if(e!=="connect"&&!this.connected)throw new Error("Wallet not connected");const t=this._nextRequestId;return++this._nextRequestId,new Promise((a,i)=>{var r,u,m,_;this._responsePromises.set(t,[a,i]),this._injectedProvider?this._injectedProvider.postMessage({jsonrpc:"2.0",id:t,method:e,params:Object.assign({network:this._network},n)}):((r=this._popup)===null||r===void 0||r.postMessage({jsonrpc:"2.0",id:t,method:e,params:n},(m=(u=this._providerUrl)===null||u===void 0?void 0:u.origin)!==null&&m!==void 0?m:""),this.autoApprove||(_=this._popup)===null||_===void 0||_.focus())})})}get publicKey(){return this._publicKey}get connected(){return this._publicKey!==null}get autoApprove(){return this._autoApprove}connect(){return A(this,void 0,void 0,function*(){this._popup&&this._popup.close(),yield this.handleConnect()})}disconnect(){return A(this,void 0,void 0,function*(){this._injectedProvider&&(yield this.sendRequest("disconnect",{})),this._popup&&this._popup.close(),this.handleDisconnect()})}sign(e,n){return A(this,void 0,void 0,function*(){if(!(e instanceof Uint8Array))throw new Error("Data must be an instance of Uint8Array");const t=yield this.sendRequest("sign",{data:e,display:n}),a=U.decode(t.signature),i=new R(t.publicKey);return{signature:a,publicKey:i}})}signTransaction(e){return A(this,void 0,void 0,function*(){const n=yield this.sendRequest("signTransaction",{message:U.encode(e.serializeMessage())}),t=U.decode(n.signature),a=new R(n.publicKey);return e.addSignature(a,t),e})}signAllTransactions(e){return A(this,void 0,void 0,function*(){const n=yield this.sendRequest("signAllTransactions",{messages:e.map(i=>U.encode(i.serializeMessage()))}),t=n.signatures.map(i=>U.decode(i)),a=new R(n.publicKey);return e=e.map((i,r)=>(i.addSignature(a,t[r]),i)),e})}diffieHellman(e){return A(this,void 0,void 0,function*(){if(!(e instanceof Uint8Array))throw new Error("Data must be an instance of Uint8Array");return yield this.sendRequest("diffieHellman",{publicKey:e})})}}function k(s){return typeof s=="string"}function C(s){return I(s)&&"postMessage"in s&&typeof s.postMessage=="function"}function I(s){return typeof s=="object"&&s!==null}export{B as default};
